<!DOCTYPE html>

<html ng-app>
    <head>
        <title>Admin Information</title>

        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("img/favicon.png")">
        <link rel="stylesheet" href="@routes.Assets.at("css/main.css")">

        <!-- framework styles -->
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("bootstrap/css/bootstrap.min.css")">        

        <!-- framework scripts -->
        <script src="@routes.Assets.at("js/jquery-1.7.1.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("bootstrap/js/bootstrap.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("js/angular-1.0.1.min.js")"></script>

        <!-- controllers -->
        <script src="@routes.Assets.at("js/MetricCtrl.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("js/HealthCtrl.js")" type="text/javascript"></script>
    </head>
    <body>

        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                </div>
            </div>
        </div>   

        <div class="container" ng-controller="HealthCtrl">
            <div class="row">  
                <div> 
                    <h2>Node Health</h2>
                </div>

                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                        <th>Node ID</th>
                        <th>Redis</th>
                        <th>Ping</th>
                    </thead>
                    <tbody>
                        <tr ng-repeat="check in health">
                            <td>{{check.machine}}</td>
                            <td>{{check.checkResults.RedisCheck.healthy}}</td>
                            <td>{{check.timestamp | date:'yyyy-MM-dd HH:mm:ss Z'}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div ng-controller="MetricCtrl" class="row">
                <div> 
                    <h2>Performance Metrics</h2>
                </div>
                <form class="well form-search">
                  <button class="btn" ng-click="loadMetrics(); loadHealth()"><i class="icon-refresh"></i></button>
                  <input type="text" class="input-medium search-query" ng-model="searchText" placeholder="Filter...">
                </form>
                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                      <th ng-click="sortBy('machine')">Node ID</th>
                      <th ng-click="sortBy('name')">Timer Name</th>
                      <th ng-click="sortBy('mean')">Mean (ms)</th>
                      <th ng-click="sortBy('median')">Median (ms)</th>
                      <th ng-click="sortBy('nfPercent')">95th Percentile (ms)</th>
                      <th ng-click="sortBy('min')">Min (ms)</th>
                      <th ng-click="sortBy('max')">Max (ms)</th>
                    </thead>
                    <tbody>
                        <tr ng-repeat="metric in metrics | filter:searchText | orderBy:sortField:reverse">
                            <td>
                                <button class="btn btn-danger" ng-click="clearMachine(metric.machine)">
                                    <i class="icon-trash icon-white"></i> {{metric.machine}}
                                </button>
                            </td>
                            <td>{{metric.name}}</td>
                            <td>{{metric.mean}}</td>
                            <td>{{metric.median}}</td>
                            <td>{{metric.nfPercent}}</td>
                            <td>{{metric.min}}</td>
                            <td>{{metric.max}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </body>
</html>
